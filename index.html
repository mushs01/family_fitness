<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>우리가족 운동관리</title>
    <meta name="description" content="가족 모두의 운동을 체계적으로 관리하는 웹앱">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4facfe">
    <!-- PWA 설정 -->
    <link rel="apple-touch-icon" href="family_image.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="우리가족 운동관리">
    
    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
</head>
<body>
    <!-- 로딩 화면 -->
    <div id="loading-screen" class="screen active">
        <div class="loading-overlay"></div>
        <div class="loading-header">
            <h1 class="loading-title">우리가족 운동관리</h1>
        </div>
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <p class="loading-text">로딩 중...</p>
        </div>
    </div>

    <!-- 프로필 선택 화면 -->
    <div id="profile-screen" class="screen">
        <div class="header">
            <div class="family-ranking">
                <div class="ranking-title-container">
                    <h3 id="family-ranking-title">🏆 이번달 가족랭킹</h3>
                </div>
                <button id="monthly-detail-btn" class="detail-btn detail-btn-left" title="월별 상세 랭킹 보기">📊</button>
                <div id="ranking-list" class="ranking-list">
                    <!-- 랭킹이 여기에 동적으로 표시됩니다 -->
                </div>
            </div>
        </div>

        <div class="profile-grid">
            <div class="profile-card" data-profile="아빠">
                <div class="rank-badge">1</div>
                <div class="profile-image-container">
                    <img src="dad.png" alt="아빠" class="profile-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                    <div class="profile-emoji" style="display:none">👨</div>
                </div>
                <h3>아빠</h3>
                <div class="profile-stats-compact">
                    <span class="score">0점</span> • <span class="grade">⛓️ 노예</span>
                </div>
            </div>

            <div class="profile-card" data-profile="엄마">
                <div class="rank-badge">2</div>
                <div class="profile-image-container">
                    <img src="mom.png" alt="엄마" class="profile-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                    <div class="profile-emoji" style="display:none">👩</div>
                </div>
                <h3>엄마</h3>
                <div class="profile-stats-compact">
                    <span class="score">0점</span> • <span class="grade">⛓️ 노예</span>
                </div>
            </div>

            <div class="profile-card" data-profile="주환">
                <div class="rank-badge">3</div>
                <div class="profile-image-container">
                    <img src="juhwan.png" alt="주환" class="profile-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                    <div class="profile-emoji" style="display:none">👦</div>
                </div>
                <h3>주환</h3>
                <div class="profile-stats-compact">
                    <span class="score">0점</span> • <span class="grade">⛓️ 노예</span>
                </div>
            </div>

            <div class="profile-card" data-profile="태환">
                <div class="rank-badge">4</div>
                <div class="profile-image-container">
                    <img src="taehwan.png" alt="태환" class="profile-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                    <div class="profile-emoji" style="display:none">🧒</div>
                </div>
                <h3>태환</h3>
                <div class="profile-stats-compact">
                    <span class="score">0점</span> • <span class="grade">⛓️ 노예</span>
                </div>
            </div>
        </div>

        <!-- 날씨 정보 섹션 -->
        <div class="weather-section">
            <div class="weather-container">
                <div class="weather-current">
                    <div class="weather-icon" id="weather-icon">🌤️</div>
                    <div class="weather-info">
                        <div class="weather-temp" id="weather-temp">--°C</div>
                        <div class="weather-desc" id="weather-desc">날씨 정보 로딩중...</div>
                        <div class="weather-location" id="weather-location">📍 위치 확인중...</div>
                    </div>
                    <button class="weather-refresh-btn" id="weather-refresh" title="날씨 새로고침">🔄</button>
                </div>
                
                <!-- 2시간 예보 -->
                <div class="weather-forecast">
                    <div class="forecast-items" id="forecast-items">
                        <div class="forecast-item">
                            <div class="forecast-time">1시간 후</div>
                            <div class="forecast-icon">🌤️</div>
                            <div class="forecast-temp">--°C</div>
                            <div class="forecast-rain">🌧️ --%</div>
                        </div>
                        <div class="forecast-item">
                            <div class="forecast-time">2시간 후</div>
                            <div class="forecast-icon">⛅</div>
                            <div class="forecast-temp">--°C</div>
                            <div class="forecast-rain">🌧️ --%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bottom-actions">
            <button class="info-btn">ℹ️ 앱 정보</button>
            <button class="exit-btn">❌ 앱 종료</button>
        </div>
    </div>

    <!-- 운동 관리 화면 -->
    <div id="exercise-screen" class="screen">
                <div class="header">
            <button class="back-btn">
                <span class="back-icon">🏡</span>
                <span class="back-text">홈으로</span>
            </button>
            <div class="profile-info">
                <img id="current-profile-img" src="" alt="" class="current-profile-image">
                <div class="profile-details">
                    <span id="current-profile-name" class="current-name"></span>
                    <span id="current-profile-grade" class="current-grade"></span>
                </div>
            </div>
        </div>

        <!-- AI 동기부여 메시지 -->
        <div class="motivation-section">
            <div class="motivation-container">
                <div class="motivation-header">
                    <div class="motivation-icon">🤖</div>
                    <div class="motivation-title">AI 코치의 한마디</div>
                    <div class="ai-status-indicator">
                        <div class="ai-brain-icon">🧠</div>
                        <div class="ai-status-text">AI 자동 생성</div>
                    </div>
                    <button class="motivation-refresh-btn" id="motivation-refresh" title="새로운 메시지 생성">🔄</button>
                </div>
                <div class="motivation-content">
                    <div class="motivation-message" id="motivation-message">
                        AI가 당신의 운동 데이터를 분석하여 맞춤형 동기부여 메시지를 생성하고 있습니다...
                    </div>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="tab-container">
                <button class="tab-btn active" data-tab="plans">📅 운동 계획</button>
                <button class="tab-btn" data-tab="calendar">📊 캘린더</button>
            </div>

            <div id="plans-tab" class="tab-content active">
                <div class="plans-header">
                    <h3>운동 계획 관리</h3>
                    <button class="add-plan-btn">+ 새 계획 추가</button>
                </div>

                <div id="plans-list" class="plans-list">
                    <!-- 운동 계획들이 여기 표시됩니다 -->
                </div>
            </div>

            <div id="calendar-tab" class="tab-content">
                <div class="calendar-header">
                    <button class="calendar-nav" data-nav="prev">◀</button>
                    <h3 id="calendar-title">2025년 1월</h3>
                    <button class="calendar-nav" data-nav="next">▶</button>
                </div>
                <div id="calendar-grid" class="calendar-grid">
                    <!-- 캘린더가 여기 표시됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 월별 랭킹 화면 -->
    <div id="monthly-ranking-screen" class="screen">
        <div class="header">
            <button class="back-btn" id="monthly-ranking-back">
                <span class="back-icon">🏡</span>
                <span class="back-text">홈으로</span>
            </button>
            <div class="header-title">
                <h2>📊 월별 가족랭킹</h2>
            </div>
        </div>

        <div class="content">
            <div class="monthly-ranking-container">
                <div class="month-selector">
                    <button class="month-nav" data-nav="prev">◀</button>
                    <h3 id="selected-month-title">2025년 1월</h3>
                    <button class="month-nav" data-nav="next">▶</button>
                </div>

                <div class="monthly-stats-summary">
                    <div class="stats-card">
                        <div class="stats-icon">🏆</div>
                        <div class="stats-info">
                            <div class="stats-label">이달의 챔피언</div>
                            <div class="stats-value" id="monthly-champion">-</div>
                        </div>
                    </div>
                    <div class="stats-card">
                        <div class="stats-icon">🎯</div>
                        <div class="stats-info">
                            <div class="stats-label">총 운동 횟수</div>
                            <div class="stats-value" id="total-exercises">0회</div>
                        </div>
                    </div>
                </div>

                <div class="monthly-ranking-list">
                    <div class="ranking-header">
                        <h4>🏅 월별 순위</h4>
                    </div>
                    <div id="monthly-ranking-items" class="ranking-items">
                        <!-- 월별 랭킹 아이템들이 여기 표시됩니다 -->
                    </div>
                </div>

                <div class="monthly-chart">
                    <div class="chart-header">
                        <h4>📈 월별 랭킹 추이</h4>
                        <div class="chart-controls">
                            <button id="chart-range-6" class="chart-range-btn active">6개월</button>
                            <button id="chart-range-12" class="chart-range-btn">12개월</button>
                        </div>
                    </div>
                    <div id="monthly-chart-content" class="chart-content">
                        <div class="ranking-chart-container">
                            <div class="chart-y-axis">
                                <div class="y-axis-label" data-rank="1">1위</div>
                                <div class="y-axis-label" data-rank="2">2위</div>
                                <div class="y-axis-label" data-rank="3">3위</div>
                                <div class="y-axis-label" data-rank="4">4위</div>
                            </div>
                            <div class="chart-area">
                                <svg id="ranking-chart-svg" class="ranking-chart-svg">
                                    <!-- 그래프 선들이 여기에 그려집니다 -->
                                </svg>
                                <div class="chart-x-axis" id="chart-x-axis">
                                    <!-- 월 라벨들이 여기 표시됩니다 -->
                                </div>
                            </div>
                        </div>
                        <div class="chart-legend" id="chart-legend">
                            <!-- 범례가 여기 표시됩니다 -->
                        </div>
                    </div>
                </div>

                <div class="monthly-details">
                    <div class="details-header">
                        <h4>📋 운동 기록 상세</h4>
                    </div>
                    <div id="monthly-details-content" class="details-content">
                        <!-- 상세 기록이 여기 표시됩니다 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 운동 계획 추가 팝업 -->
    <div id="add-plan-popup" class="popup">
        <div class="popup-content">
            <h3>새 운동 계획 추가</h3>
            <form id="plan-form">
                <div class="form-group">
                    <label>운동 종류</label>
                    <select id="exercise-type">
                        <option value="러닝">🏃 러닝</option>
                        <option value="러닝머신">🏃‍♀️ 러닝머신</option>
                        <option value="걷기">🚶 걷기</option>
                        <option value="자전거">🚴 자전거</option>
                        <option value="수영">🏊 수영</option>
                        <option value="기구운동">🏋️ 기구운동</option>
                        <option value="요가">🧘 요가</option>
                        <option value="야구">⚾ 야구</option>
                        <option value="축구">⚽ 축구</option>
                        <option value="농구">🏀 농구</option>
                        <option value="기타">🏃‍♂️ 기타</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>운동 내용</label>
                    <input type="text" id="exercise-content" placeholder="예: 30분간 러닝머신">
                </div>
                <div class="form-group">
                    <label>시작 날짜</label>
                    <input type="date" id="start-date">
                </div>
                <div class="form-group">
                    <label>종료 날짜</label>
                    <input type="date" id="end-date">
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-btn">취소</button>
                    <button type="submit" class="save-btn">저장</button>
                </div>
            </form>
        </div>
    </div>

    <script src="app.js?v=3.0"></script>
    
    <!-- Service Worker 등록 -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js')
                    .then(function(registration) {
                        console.log('Service Worker 등록 성공:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('Service Worker 등록 실패:', error);
                    });
            });
        }
    </script>
</body>
</html>
